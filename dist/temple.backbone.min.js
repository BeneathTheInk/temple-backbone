!function(a,b){"use strict";if("undefined"!=typeof module&&module.exports&&"function"==typeof require)b(require("temple-mustache"),require("backbone"));else if("function"==typeof define&&define.amd)define(["temple-mustache","backbone"],b);else{if(!a.Mustache||!a.Backbone)throw new Error("Could not find Temple Mustache or Backbone!");b(a.Mustache,a.Backbone)}}("undefined"!=typeof window?window:this,function(a,b){a.registerPlugin("backbone",function(){this.registerProxy(c),this.registerProxy(d)});var c=a.Proxy.extend({constructor:function(a,b){this.target=a,this.model=b,this.target.on("change",this._onChange=function(){for(var a in this.changed)b.set(a,this.changed[a],{reset:!0})})},isLeaf:function(){return!1},get:function(a){return c.get(this.target,a)},set:function(a,b){return this.target.set(a,b),!0},keys:function(){return this.target.keys()},unset:function(a){return this.target.unset(a),!0},merge:function(b){return a.util.isPlainObject(b)?(this.target.set(b),!0):!1},destroy:function(){this.target.off("change",this._onChange)}},{match:function(a){return a instanceof b.Model},get:function(a,b){return a.get(b)}}),d=a.Proxy.extend({constructor:function(a,b){this.target=a,this.model=b;var c=a.toArray();this.set("length",a.length),this.listenTo(a,"add remove sort reset",function(){var d=a.toArray();d.forEach(function(a,c){b.set(c.toString(),a),b.set(a.cid,a),null!=a.id&&b.set(a.id,a)});var e=c.filter(function(a){return d.indexOf(a)<0});if(e.length){e.forEach(function(a){b.unset(a.cid),null!=a.id&&b.unset(a.id)});for(var f=0;f<e.length;f++)b.unset((d.length+f).toString())}c=d,b.set("length",a.length)})},isLeaf:function(){return!1},toArray:function(){return this.target.toArray()},get:function(a){return d.get(this.target,a)},set:function(){return!0},keys:function(){return Object.keys(this.target.toArray())},unset:function(){return!0},merge:function(){return!1},destroy:function(){this.stopListening(this.target)}},{match:function(a){return a instanceof b.Collection},get:function(a,b){return"length"===b?a.length:a.at(b)||a.get(b)}})});